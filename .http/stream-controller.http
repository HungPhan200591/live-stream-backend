### Stream Controller API Tests
### Xem doc: docs/api_endpoints_specification.md#stream-management
### ============================================================
### PUBLIC ENDPOINTS
### ============================================================

### Get all live streams (Public)
GET {{host}}/api/streams
Content-Type: application/json

### Get all streams (including ended) (Public)
GET {{host}}/api/streams?liveOnly=false
Content-Type: application/json

### Get stream by ID (Public)
GET {{host}}/api/streams/1
Content-Type: application/json

### ============================================================
### VIEWER TRACKING (Public - Redis HyperLogLog)
### ============================================================

### Track viewer - Anonymous user (gọi định kỳ 30s làm heartbeat)
POST {{host}}/api/streams/1/view
Content-Type: application/json

### Get realtime viewer count
GET {{host}}/api/streams/1/viewers
Content-Type: application/json

### Track viewer - Authenticated user
POST {{host}}/api/streams/1/view
Authorization: Bearer {{token}}
Content-Type: application/json

### ============================================================
### AUTHENTICATED ENDPOINTS (Requires Login)
### ============================================================

### Create new stream (STREAMER/ADMIN only)
# @name createStream
POST {{host}}/api/streams
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "title": "My Gaming Stream",
  "description": "Playing Valorant ranked - Road to Diamond!"
}

### Get my streams (current user's streams)
GET {{host}}/api/streams/my
Authorization: Bearer {{token}}
Content-Type: application/json

### ============================================================
### STREAM LIFECYCLE (via Webhooks)
### ============================================================
# Stream start/end is managed via RTMP server webhooks.
# See: .http/webhook-controller.http
# See: docs/concepts/webhooks.md

### ============================================================
### USAGE NOTES
### ============================================================
# 1. Trước tiên, đăng nhập qua auth-controller.http để lấy token
# 2. User phải có ROLE_STREAMER hoặc ROLE_ADMIN để tạo stream
# 3. Nếu chỉ có ROLE_USER, sẽ nhận được 403 Forbidden

### ============================================================
### FULL LIFECYCLE TEST FLOW (với Webhook)
### ============================================================
# 1. Login as STREAMER: POST /api/auth/login
# 2. Create stream: POST /api/streams → nhận streamKey
# 3. (RTMP) Webhook: POST /api/webhooks/rtmp/stream-started {streamKey}
# 4. Track viewers: POST /api/streams/{streamId}/view (nhiều lần)
# 5. Check count: GET /api/streams/{streamId}/viewers
# 6. (RTMP) Webhook: POST /api/webhooks/rtmp/stream-ended {streamKey}
# 7. Verify Redis: docker exec -it redis redis-cli EXISTS stream:{streamId}:live

### ============================================================
### VIEWER TRACKING TEST FLOW
### ============================================================
# 1. Gọi POST /api/streams/1/view nhiều lần (simulate nhiều viewers)
# 2. Gọi GET /api/streams/1/viewers để xem unique count
# 3. Redis HyperLogLog chỉ đếm unique viewers với ~0.81% error
# 4. Kiểm tra trong Redis: docker exec -it redis redis-cli PFCOUNT stream:1:viewers
